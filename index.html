<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simulated Miner — Single File Demo</title>

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" defer></script>

  <style>
    /* Simple modern theme */
    :root{
      --bg:#071028;
      --card: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      --accent:#6d28d9;
      --muted:rgba(230,238,248,0.75);
      --glass: rgba(255,255,255,0.04);
      --success:#22c55e;
      --danger:#ef4444;
    }
    html,body{height:100%;margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;}
    body{background:radial-gradient(800px 400px at 10% 10%, rgba(109,40,217,0.12), transparent), var(--bg); color:var(--muted); -webkit-font-smoothing:antialiased; display:flex; align-items:stretch; justify-content:center; padding:28px;}
    .app{width:100%; max-width:1150px; display:grid; grid-template-columns: 360px 1fr; gap:20px; align-items:start;}
    .panel{background:var(--card); border-radius:14px; padding:18px; box-shadow: 0 10px 30px rgba(2,6,23,0.7);}
    .brand{display:flex; gap:12px; align-items:center;}
    .logo{width:46px;height:46px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#06b6d4);display:flex;align-items:center;justify-content:center;font-weight:700;color:white;font-size:18px}
    h1,h2,h3,h4{margin:0;color:#eaf2ff}
    small{color:rgba(230,238,248,0.6)}
    /* Left column */
    .left{display:flex;flex-direction:column;gap:14px;}
    .login-form{display:flex;flex-direction:column;gap:10px}
    input[type="text"],input[type="password"]{background:transparent;border:1px solid rgba(255,255,255,0.06); padding:10px;border-radius:8px;color:var(--muted);outline:none}
    .btn{padding:10px 12px;border-radius:10px;border:none;background:var(--accent);color:white;cursor:pointer;font-weight:600}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .muted{color:rgba(230,238,248,0.6);font-size:13px}
    .stat-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .stat{background:var(--glass); padding:12px;border-radius:10px; text-align:center}
    .stat h3{font-size:18px}
    .controls{display:flex;gap:8px}
    .logs{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:10px;border-radius:8px; max-height:220px; overflow:auto; font-family:monospace; font-size:13px}
    .btn-red{background:var(--danger)}
    .topbar{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px}
    /* Right column */
    .right{display:flex;flex-direction:column;gap:14px}
    .header-row{display:flex;align-items:center;justify-content:space-between;gap:12px}
    canvas{width:100% !important; height:280px !important}
    .payouts{display:flex;flex-direction:column;gap:8px}
    .payout{display:flex;justify-content:space-between;padding:10px;border-radius:8px;background:rgba(255,255,255,0.02)}
    footer{font-size:13px;color:rgba(230,238,248,0.5); text-align:center; margin-top:10px}
    @media (max-width:1000px){ .app{grid-template-columns:1fr; padding:10px} .left{order:2} .right{order:1} canvas{height:220px !important}}
  </style>
</head>
<body>
  <div class="app" id="app">
    <!-- LEFT: Account / Controls -->
    <div class="panel left">
      <div class="brand">
        <div class="logo">SM</div>
        <div>
          <h2>Simulated Miner</h2>
          <small>Browser-only demo • No real mining</small>
        </div>
      </div>

      <!-- Login/Register -->
      <div id="auth-area" class="panel" style="padding:14px; margin-top:8px;">
        <div id="auth-forms">
          <div class="login-form">
            <input id="username" type="text" placeholder="Username" value="demo" />
            <input id="password" type="password" placeholder="Password" value="password" />
            <div style="display:flex; gap:8px;">
              <button class="btn" id="loginBtn">Login</button>
              <button class="btn secondary" id="registerBtn">Register</button>
            </div>
            <div id="auth-msg" class="muted" style="margin-top:8px"></div>
          </div>
        </div>

        <div id="account-area" style="display:none;">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div style="font-size:13px;color:rgba(230,238,248,0.6)">Signed in as</div>
              <div id="acctName" style="font-weight:700;font-size:16px">—</div>
            </div>
            <div>
              <button class="btn secondary" id="logoutBtn">Logout</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Stats -->
      <div class="panel" style="margin-top:10px;">
        <h4>Overview</h4>
        <div style="height:8px"></div>
        <div class="stat-grid">
          <div class="stat">
            <div style="font-size:12px;color:rgba(230,238,248,0.6)">Workers</div>
            <h3 id="statWorkers">—</h3>
          </div>
          <div class="stat">
            <div style="font-size:12px;color:rgba(230,238,248,0.6)">Total Hashrate</div>
            <h3 id="statHash">—</h3>
          </div>
          <div class="stat">
            <div style="font-size:12px;color:rgba(230,238,248,0.6)">Balance (BTC)</div>
            <h3 id="statBal">—</h3>
          </div>
          <div class="stat">
            <div style="font-size:12px;color:rgba(230,238,248,0.6)">Uptime</div>
            <h3 id="statUptime">00:00:00</h3>
          </div>
        </div>
      </div>

      <!-- Controls -->
      <div class="panel" style="margin-top:10px;">
        <h4>Controls</h4>
        <div style="height:8px"></div>
        <div class="controls">
          <button class="btn" id="startBtn">Start Mining</button>
          <button class="btn btn-red" id="stopBtn" disabled>Stop</button>
        </div>
        <div style="height:10px"></div>
        <div class="muted">Mining is simulated locally — you can start and stop to see changing hashrates and fake mined amounts.</div>
      </div>

      <!-- Logs -->
      <div class="panel" style="margin-top:10px;">
        <h4>Activity Log</h4>
        <div style="height:8px"></div>
        <div id="logs" class="logs"></div>
      </div>

    </div>

    <!-- RIGHT: Chart, payouts, etc -->
    <div class="panel right">
      <div class="header-row">
        <div>
          <h3 id="greeting">Welcome</h3>
          <small id="subGreeting">Start the miner to see live data</small>
        </div>
        <div>
          <div style="display:flex;gap:10px;align-items:center">
            <div style="text-align:right">
              <div style="font-size:12px;color:rgba(230,238,248,0.6)">Estimated daily</div>
              <div style="font-weight:700">~0.0012 BTC</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Chart -->
      <div class="panel" style="padding:12px;">
        <h4>Hashrate (MH/s)</h4>
        <canvas id="hashChart"></canvas>
        <div style="display:flex; gap:10px; margin-top:10px;">
          <div style="flex:1">
            <div class="muted">Current hash</div>
            <div id="currentHash" style="font-weight:700;font-size:18px">— MH/s</div>
          </div>
          <div style="flex:1">
            <div class="muted">Mined (session)</div>
            <div id="minedSession" style="font-weight:700;font-size:18px">0.00000000 BTC</div>
          </div>
        </div>
      </div>

      <!-- Payouts -->
      <div class="panel" style="padding:12px;">
        <h4>Payout history</h4>
        <div class="payouts" id="payouts">
          <!-- filled by JS -->
        </div>
      </div>

      <footer>
        This demo is offline & simulated. Never paste or store real keys here.
      </footer>
    </div>
  </div>

<script>
/*
  Single-file simulated mining dashboard
  - Users stored in localStorage under "sim_users" object {username: {passwordHash,...}}
  - Logged-in username stored in "sim_logged_in"
  - Mining simulation uses setInterval and produces random hash & mined increments
  - Chart.js used to visualize hashrate over time
*/

/* -------- Utilities -------- */
function el(id){ return document.getElementById(id); }
function nowISO(){ return new Date().toISOString(); }
function formatBTC(x){ return Number(x).toFixed(8); }
function randBetween(a,b){ return Math.random()*(b-a)+a; }
function humanTime(s){
  const h=Math.floor(s/3600), m=Math.floor((s%3600)/60), sec=Math.floor(s%60);
  return [h,m,sec].map(n=>String(n).padStart(2,'0')).join(':');
}

/* -------- Simple storage (NOT secure, demo only) -------- */
const Storage = {
  getUsers(){ return JSON.parse(localStorage.getItem('sim_users')||'{}'); },
  saveUsers(u){ localStorage.setItem('sim_users', JSON.stringify(u)); },
  setLogged(user){ localStorage.setItem('sim_logged_in', user); },
  getLogged(){ return localStorage.getItem('sim_logged_in'); },
  clearLogged(){ localStorage.removeItem('sim_logged_in'); }
};

/* -------- Auth handlers -------- */
const loginBtn = el('loginBtn'), regBtn = el('registerBtn'), logoutBtn = el('logoutBtn');
const usernameInput = el('username'), passwordInput = el('password'), authMsg = el('auth-msg');
const authArea = el('auth-area'), accountArea = el('account-area'), acctName = el('acctName');

loginBtn.addEventListener('click', ()=> {
  const u=usernameInput.value.trim(), p=passwordInput.value;
  if(!u||!p){ authMsg.textContent='provide username and password'; return; }
  const users=Storage.getUsers();
  if(!users[u] || users[u].password !== p){ authMsg.textContent='invalid credentials (demo)'; return; }
  Storage.setLogged(u);
  authMsg.textContent='logged in';
  setTimeout(()=>renderAuth(),400);
});
regBtn.addEventListener('click', ()=> {
  const u=usernameInput.value.trim(), p=passwordInput.value;
  if(!u||!p){ authMsg.textContent='provide username and password'; return; }
  const users=Storage.getUsers();
  if(users[u]){ authMsg.textContent='username taken'; return; }
  users[u] = { password: p, created: nowISO(), payouts: [
    {id:1, amount:0.002310, date:'2025-10-01'},
    {id:2, amount:0.001420, date:'2025-09-18'}
  ]};
  Storage.saveUsers(users);
  Storage.setLogged(u);
  authMsg.textContent='registered and logged in';
  setTimeout(()=>renderAuth(),400);
});
logoutBtn.addEventListener('click', ()=> {
  Storage.clearLogged();
  renderAuth();
});

/* -------- Mining simulation -------- */
let miner = {
  running:false,
  intervalId:null,
  uptimeSec:0,
  workers:3,
  totalHash: 0,
  sessionMined: 0,
  balance: 0,
  lastTick: null
};
const startBtn = el('startBtn'), stopBtn = el('stopBtn');
const statWorkers = el('statWorkers'), statHash = el('statHash'), statBal = el('statBal'), statUptime = el('statUptime');
const logsEl = el('logs'), greeting = el('greeting'), subGreeting = el('subGreeting');
const currentHash = el('currentHash'), minedSession = el('minedSession'), statMined = el('statMined');

startBtn.addEventListener('click', ()=> startMining());
stopBtn.addEventListener('click', ()=> stopMining());

function logLine(s){
  const d = new Date();
  const t = d.toLocaleTimeString();
  const node = document.createElement('div');
  node.textContent = `[${t}] ${s}`;
  logsEl.prepend(node);
  // keep at most 200 lines
  while(logsEl.childElementCount>200) logsEl.removeChild(logsEl.lastChild);
}

/* -------- Chart (Chart.js) -------- */
let chartCtx = document.getElementById('hashChart').getContext('2d');
let hashChart = null;
function createChart(){
  const config = {
    type: 'line',
    data: {
      labels: [],
      datasets: [{
        label: 'Hashrate (MH/s)',
        data: [],
        tension: 0.3,
        borderWidth: 2,
        pointRadius: 0,
        // colors left to Chart.js defaults
      }]
    },
    options: {
      animation:false,
      responsive:true,
      plugins:{legend:{display:false}},
      scales:{
        x:{display:true, grid:{display:false}, ticks:{maxTicksLimit:8}},
        y:{beginAtZero:true}
      }
    }
  };
  hashChart = new Chart(chartCtx, config);
}
createChart();

function pushChart(value){
  const now = new Date();
  const label = now.toLocaleTimeString();
  hashChart.data.labels.push(label);
  hashChart.data.datasets[0].data.push(value);
  // keep 40 points
  if(hashChart.data.labels.length>40){
    hashChart.data.labels.shift();
    hashChart.data.datasets[0].data.shift();
  }
  hashChart.update('none');
}

/* -------- Mining tick logic -------- */
function startMining(){
  if(miner.running) return;
  miner.running = true;
  miner.intervalId = setInterval(minerTick, 1500);
  miner.uptimeSec = 0;
  miner.sessionMined = 0;
  startBtn.disabled = true;
  stopBtn.disabled = false;
  logLine('Mining started (simulated)');
  subGreeting.textContent = 'Mining live — simulating pool connection';
  // UI update every second for uptime
  miner.uptimeTicker = setInterval(()=>{ miner.uptimeSec++; statUptime.textContent = humanTime(miner.uptimeSec); },1000);
}

function stopMining(){
  if(!miner.running) return;
  miner.running = false;
  clearInterval(miner.intervalId);
  clearInterval(miner.uptimeTicker);
  startBtn.disabled = false;
  stopBtn.disabled = true;
  // commit session mined to balance
  miner.balance += miner.sessionMined;
  logLine(`Mining stopped. Session mined ${formatBTC(miner.sessionMined)} BTC — added to balance`);
  updateUI();
}

function minerTick(){
  // Simulate total hashrate (workers * per-worker)
  const perWorker = randBetween(20,120); // MH/s
  const variance = (Math.random()*0.6 + 0.7); // 0.7-1.3
  const total = (miner.workers * perWorker * variance);
  miner.totalHash = Number(total.toFixed(2));
  // Simulate mined BTC per tick (very small)
  // Use a fake conversion: total MH/s -> chance to mine tiny btc per tick
  // purely arbitrary for demo:
  const mined = Number((Math.random() * 0.0000009 * (miner.totalHash/150)).toFixed(8));
  miner.sessionMined = Number((miner.sessionMined + mined).toFixed(8));
  miner.lastTick = mined;
  // Update chart & UI
  pushChart(miner.totalHash);
  currentHash.textContent = `${miner.totalHash.toFixed(2)} MH/s`;
  minedSession.textContent = `${formatBTC(miner.sessionMined)} BTC`;
  statHash.textContent = `${miner.totalHash.toFixed(2)} MH/s`;
  statWorkers.textContent = miner.workers;
  statBal.textContent = formatBTC(miner.balance);
  logLine(`tick — ${miner.totalHash.toFixed(2)} MH/s — mined ${formatBTC(mined)} BTC`);
  // occasionally push a mock payout event
  if(Math.random()<0.03){
    createPayout( (0.0009 + Math.random()*0.003).toFixed(6) );
  }
}

/* -------- Payouts ui -------- */
const payoutsEl = el('payouts');
function renderPayouts(){
  payoutsEl.innerHTML = '';
  const users = Storage.getUsers();
  const logged = Storage.getLogged();
  const defaultPayouts = [
    {id:1, amount:0.002310, date:'2025-10-01'},
    {id:2, amount:0.001420, date:'2025-09-18'}
  ];
  const userPayouts = users[logged] && users[logged].payouts ? users[logged].payouts : defaultPayouts;
  userPayouts.slice().reverse().forEach(p=>{
    const div = document.createElement('div');
    div.className='payout';
    div.innerHTML = `<div>🔁 Payout #${p.id} <div style="font-size:12px;color:rgba(230,238,248,0.6)">${p.date}</div></div><div style="font-weight:700">${Number(p.amount).toFixed(6)} BTC</div>`;
    payoutsEl.appendChild(div);
  });
}
function createPayout(amount){
  const users=Storage.getUsers(), u=Storage.getLogged();
  const p = { id: Date.now()%100000, amount: Number(amount), date: new Date().toISOString().slice(0,10) };
  if(users[u]){
    users[u].payouts = users[u].payouts || [];
    users[u].payouts.push(p);
    Storage.saveUsers(users);
  }
  renderPayouts();
  logLine(`Payout executed: ${Number(amount).toFixed(6)} BTC`);
}

/* -------- UI state and render -------- */
function renderAuth(){
  const logged = Storage.getLogged();
  if(logged){
    authArea.querySelector('#auth-forms').style.display='none';
    accountArea.style.display='block';
    acctName.textContent = logged;
    greeting.textContent = `Hi, ${logged}`;
    subGreeting.textContent = `Simulated dashboard — no real funds.`;
    renderPayouts();
    updateUI();
  } else {
    authArea.querySelector('#auth-forms').style.display='block';
    accountArea.style.display='none';
    acctName.textContent = '—';
    greeting.textContent = 'Welcome';
    subGreeting.textContent = 'Sign in to personalize stats';
    updateUI();
  }
}

function updateUI(){
  statWorkers.textContent = miner.workers;
  statHash.textContent = miner.totalHash ? `${miner.totalHash.toFixed(2)} MH/s` : '—';
  statBal.textContent = formatBTC(miner.balance || 0);
  statUptime.textContent = humanTime(miner.uptimeSec || 0);
  currentHash.textContent = miner.totalHash ? `${miner.totalHash.toFixed(2)} MH/s` : '—';
  minedSession.textContent = formatBTC(miner.sessionMined || 0);
}

/* Initialize: populate default demo user if none */
(function initDemo(){
  const users=Storage.getUsers();
  if(!users['demo']){
    users['demo'] = { password: 'password', created: nowISO(), payouts: [
      {id:1, amount:0.002310, date:'2025-10-01'},
      {id:2, amount:0.001420, date:'2025-09-18'}
    ]};
    Storage.saveUsers(users);
  }
  renderAuth();
  // Nice initial chart seed
  for(let i=0;i<10;i++){
    const v = randBetween(60,240);
    pushChart(Number(v.toFixed(2)));
  }
  logLine('Simulated dashboard loaded');
})();

/* Extra: keyboard enter triggers login */
passwordInput.addEventListener('keydown', e=>{ if(e.key==='Enter') loginBtn.click(); });

</script>
</body>
    </html>
